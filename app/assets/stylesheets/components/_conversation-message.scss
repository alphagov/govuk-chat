$message-container-spacing-tablet: 55px;
$message-container-spacing-mobile: 40px;

.app-c-conversation-message {
  list-style: none;

  &:last-child {
    scroll-margin-top: govuk-spacing(2);
  }
}

.app-c-conversation-message__message {
  display: flex;
}

.app-c-conversation-message__message--user-message {
  $message-icon-container-size: 30px;
  justify-content: flex-end;
  margin: govuk-spacing(4) 0 govuk-spacing(4) auto;
  max-width: calc(100% - ($message-container-spacing-mobile + $message-icon-container-size));

  @include govuk-media-query($from: tablet) {
    margin: govuk-spacing(6) 0 govuk-spacing(6) auto;
    max-width: calc(100% - ($message-container-spacing-tablet + $message-icon-container-size));
  }
}

.app-c-conversation-message__message--govuk-message {
  margin: govuk-spacing(3) 0;
  @include govuk-media-query($from: tablet) {
    margin: govuk-spacing(5) 0;
  }
}

.app-c-conversation-message__feedback {
  margin: 0 0 govuk-spacing(3);
  @include govuk-media-query($from: tablet) {
    margin: 0 0 govuk-spacing(5);
  }
}

.app-c-conversation-message__message--govuk-message, .app-c-conversation-message__feedback {
  width: calc(100% - $message-container-spacing-mobile);

  @include govuk-media-query($from: tablet) {
    width: calc(100% - $message-container-spacing-tablet);
  }
}

.app-c-conversation-message__message--govuk-message:has(~ .app-c-conversation-message__feedback) {
  margin: govuk-spacing(2) 0;

  @include govuk-media-query($from: tablet) {
    margin: govuk-spacing(3) 0;
  }
}

.app-c-conversation-message__body {
  padding: govuk-spacing(3);
  overflow: hidden;
  overflow-wrap: break-word;

  // two classes used to increase specificity
  .gem-c-govspeak.govuk-govspeak :last-child {
    margin-bottom: 0;
  }
}

.app-c-conversation-message__identifier {
  margin-right: govuk-spacing(2);
}

.app-c-conversation-message__body--govuk-message {
  background-color: govuk-colour("light-grey");
  // Add an outline to messages to ensure they are clearly delineated in high contrast mode.
  // Using a negative value for the outline-offset property ensures that the outline
  // aligns with the edge of the message body container
  outline: 1px solid govuk-colour("light-grey");
  outline-offset: -1px;
}

.app-c-conversation-message__body--user-message {
  background-color: govuk-tint(govuk-colour("light-blue"), 75%);
  outline: 1px solid govuk-tint(govuk-colour("light-blue"), 75%);
  outline-offset: -1px;
}

.app-c-conversation-message__loading-text {
  padding-right: govuk-spacing(3);
  position: relative;
}

.app-c-conversation-message__loading-text.govuk-body {
  margin-bottom: 0;
}

.app-c-conversation-message__loading-ellipsis {
  position: absolute;
  color: transparent;
  top: 0;

  &::after {
    position: absolute;
    color: govuk-colour("black");
    left: 0;
    animation: ellipsis steps(1, end) 1s infinite;
    content: '';
  }
}

@keyframes ellipsis {
  0% {
    content: '';
  }

  25% {
    content: '.';
  }

  50% {
    content: '..';
   }

  75% {
    content: '...';
  }

  100% {
    content: '';
  }
}

.app-c-conversation-message--fade-in {
  animation: fade-in 0.3s ease-in-out;
}

@keyframes fade-in {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}
