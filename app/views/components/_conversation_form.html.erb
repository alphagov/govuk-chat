<%
  input_id ||= "#{name.parameterize}-#{SecureRandom.hex(4)}"
  value ||= nil

  maxlength = Form::CreateQuestion::USER_QUESTION_LENGTH_MAXIMUM
  presence_error_message = Form::CreateQuestion::USER_QUESTION_PRESENCE_ERROR_MESSAGE
  length_error_message = Form::CreateQuestion::USER_QUESTION_LENGTH_ERROR_MESSAGE

  hint = "Please limit your question to #{maxlength} characters."
  hint_id = "#{input_id}-hint"

  error_items ||= []
  has_error ||= error_items.any?
  error_id = "#{input_id}-error"

  aria_described_by = []
  aria_described_by << hint_id
  aria_described_by << error_id
  aria_described_by = aria_described_by.join(" ")

  data_attributes = {
    module: "conversation-form",
    maxlength: maxlength,
    "presence-error-message": presence_error_message,
    "length-error-message": sprintf(length_error_message, count: maxlength),
  }
%>

<%= form_with url: url, class: "app-c-conversation-form", data: data_attributes do |f| %>
  <%= content_tag :div, class: "app-c-conversation-form__input-wrapper" do %>
    <%= label_tag(
      input_id,
      "Enter your question (please do not share personal or sensitive information in your conversations with GOV UK chat)",
      class: "app-c-conversation-form__label govuk-visually-hidden",
    ) %>

    <%= text_field_tag(
      input_id,
      value,
      class: "app-c-conversation-form__input js-conversation-form-input",
      aria: {
        describedby: aria_described_by,
      },
      name: name,
    ) %>

    <%= render "components/blue_button", {
      text: "Send",
      conversation_form_button: true,
    } %>
  <% end %>

  <%= tag.ul(id: error_id, class: %w[govuk-list govuk-error-message js-conversation-form-errors-wrapper], hidden: !has_error) do %>
    <% error_items.each do |error| %>
      <li>
        <span class="govuk-visually-hidden">Error:</span>
        <%= error[:text] %>
      </li>
    <% end %>
  <% end %>

  <div class="govuk-visually-hidden">
    <%= render "govuk_publishing_components/components/hint", {
      id: hint_id,
      text: hint,
    } %>
  </div>
<% end %>
