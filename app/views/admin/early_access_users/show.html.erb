<%= content_for :title, "User details" %>

<%= content_for :breadcrumbs do %>
  <%= render "govuk_publishing_components/components/breadcrumbs", {
    collapse_on_mobile: true,
    breadcrumbs: [
      {
        title: "Early access users",
        url: admin_early_access_users_path,
      },
      {
        title: "User details",
      },
    ],
  } %>
<% end %>

<%
  question_limit = @user.question_limit.nil? ? Rails.configuration.conversations.max_questions_per_user : @user.question_limit

  summary_items = [
    {
      field: "Email",
      value: @user.email,
    },
    {
      field: "Last login",
      value: @user.last_login_at ? @user.last_login_at.to_fs(:time_and_date) : "Never",
    },
    {
      field: "Source",
      value: @user.source.humanize,
    },
    {
      field: "User research question: #{PilotUser::USER_RESEARCH_QUESTION_DESCRIPTION}",
      value: @user.user_description,
    },
    {
      field: "User research question: #{PilotUser::USER_RESEARCH_QUESTION_REASON_FOR_VISIT}",
      value: @user.reason_for_visit,
    },
    {
      field: "Questions asked",
      value: @user.questions_count.zero? ? "0" : link_to(@user.questions_count, admin_questions_path(user_id: @user.id), class: "govuk-link"),
    },
    {
      field: "Question limit",
      value: question_limit.zero? ? "Unlimited" : question_limit,
    },
  ]

  if @user.access_revoked?
    summary_items << [
      {
        field: "Revoked on",
        value: @user.revoked_at.to_fs(:time_and_date),
      },
      {
        field: "Revoked reason",
        value: @user.revoked_reason,
      },
    ]
  else
    summary_items << {
      field: "Revoked?",
      value:  "No",
    }
  end
%>

<%= render "govuk_publishing_components/components/summary_list", {
  items: summary_items.flatten,
} %>

<%= render "govuk_publishing_components/components/button", {
  text: "Edit user",
  href: edit_admin_early_access_user_path(@user),
} %>

<%= render "govuk_publishing_components/components/button", {
  text: "Delete user",
  href: delete_admin_early_access_user_path(@user),
  destructive: true,
} %>

<% if @user.access_revoked? %>
  <%= form_with url: restore_admin_early_access_user_path(@user), method: :patch do |f| %>
    <%= render "govuk_publishing_components/components/button", {
      text: "Restore access",
    } %>
  <% end %>
<% else %>
  <%= render "govuk_publishing_components/components/button", {
    text: "Revoke access",
    href: revoke_admin_early_access_user_path(@user),
    destructive: true,
  } %>
<% end %>
