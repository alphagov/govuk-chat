<%
content_for(:title, "User details")
content_for(:active_navigation_item, admin_early_access_users_path)
%>

<%= content_for :breadcrumbs do %>
  <%= render "govuk_publishing_components/components/breadcrumbs", {
    collapse_on_mobile: true,
    breadcrumbs: [
      {
        title: "Early access users",
        url: admin_early_access_users_path,
      },
      {
        title: "User details",
      },
    ],
  } %>
<% end %>

<%
  summary_items = [
    {
      field: "Email",
      value: @user.email,
    },
    {
      field: "Logins",
      value: @user.login_count,
    },
    {
      field: "Last login",
      value: @user.last_login_at ? @user.last_login_at.to_fs(:time_and_date) : "Never",
    },
    {
      field: "Source",
      value: @user.source.humanize,
    },
    {
      field: "User research question: #{user_research_question_text(:user_description)}",
      value: user_research_question_option_text(:user_description, @user.user_description),
    },
    {
      field: "User research question: #{user_research_question_text(:reason_for_visit)}",
      value: user_research_question_option_text(:reason_for_visit, @user.reason_for_visit),
    },
    {
      field: "User research question: #{user_research_question_text(:found_chat)}",
      value: user_research_question_option_text(:found_chat, @user.found_chat),
    },
    {
      field: "Questions asked",
      value: @user.questions_count.zero? ? "0" : link_to(@user.questions_count, admin_questions_path(user_id: @user.id), class: "govuk-link"),
    },
    {
      field: "Question limit",
      value: @user.unlimited_question_allowance? ? "Unlimited" : @user.question_limit,
    },
    {
      field: "Bannable action count",
      value: @user.bannable_action_count,
    },
  ]

  if @user.access_revoked?
    summary_items << [
      {
        field: "Revoked on",
        value: @user.revoked_at.to_fs(:time_and_date),
      },
      {
        field: "Revoked reason",
        value: @user.revoked_reason,
      },
    ]
  else
    summary_items << {
      field: "Revoked?",
      value:  "No",
    }
  end

  if @user.shadow_banned?
    summary_items << [
      {
        field: "Shadow banned on",
        value: @user.shadow_banned_at.to_fs(:time_and_date),
      },
      {
        field: "Shadow banned reason",
        value: @user.shadow_banned_reason,
      },
    ]
  else
    summary_items << {
      field: "Shadow banned?",
      value:  "No",
    }
  end

  if @user.restored?
    summary_items << [
      {
        field: "Restored on",
        value: @user.restored_at.to_fs(:time_and_date),
      },
      {
        field: "Restored reason",
        value: @user.restored_reason,
      },
    ]
  else
    summary_items << {
      field: "Restored?",
      value:  "No",
    }
  end
%>

<%= render "govuk_publishing_components/components/summary_list", {
  items: summary_items.flatten,
} %>

<%= render "govuk_publishing_components/components/button", {
  text: "Edit user",
  href: edit_admin_early_access_user_path(@user),
} %>

<%= render "govuk_publishing_components/components/button", {
  text: "Delete user",
  href: delete_admin_early_access_user_path(@user),
  destructive: true,
} %>

<% if @user.access_revoked? %>
  <%= form_with url: restore_admin_early_access_user_path(@user), method: :patch do |f| %>
    <%= render "govuk_publishing_components/components/button", {
      text: "Restore access",
    } %>
  <% end %>
<% else %>
  <%= render "govuk_publishing_components/components/button", {
    text: "Revoke access",
    href: revoke_admin_early_access_user_path(@user),
    destructive: true,
  } %>
<% end %>
